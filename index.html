<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Tennis Ranking</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h1, h2, h3 { color: #333; }
    form { margin-bottom: 30px; }
    input, select { margin: 5px; padding: 5px; }
    button { padding: 5px 10px; margin: 5px 0; }
    table { border-collapse: collapse; width: 300px; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    ul { padding-left: 20px; }
    li { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>Tennis Ranking</h1>

  <form id="matchForm">
    <label>Spieler A:
      <select name="playerA" required>
        <option value="Ali">Ali</option>
        <option value="Ben">Ben</option>
        <option value="Chris">Chris</option>
      </select>
    </label><br>
    <label>Spieler B:
      <select name="playerB" required>
        <option value="Ali">Ali</option>
        <option value="Ben">Ben</option>
        <option value="Chris">Chris</option>
      </select>
    </label><br>
    <label>Gewinner:
      <select name="winner" required>
        <option value="Ali">Ali</option>
        <option value="Ben">Ben</option>
        <option value="Chris">Chris</option>
      </select>
    </label><br>
    <button type="submit">Match eintragen</button>
  </form>

  <h2>Aktuelles Ranking</h2>
  <table id="rankingTable">
    <thead><tr><th>Spieler</th><th>Punkte</th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>Manueller Punktebonus</h3>
  <select id="bonusPlayer">
    <option value="Ali">Ali</option>
    <option value="Ben">Ben</option>
    <option value="Chris">Chris</option>
  </select>
  <button onclick="giveBonus(10)">+10</button>
  <button onclick="giveBonus(20)">+20</button>
  <button onclick="giveBonus(30)">+30</button>

  <h2>Match-Historie</h2>
  <ul id="matchHistoryList"></ul>

  <script>
    const defaultPlayers = {
      Ali: 1000,
      Ben: 1000,
      Chris: 1000
    };

    function loadPlayers() {
      return JSON.parse(localStorage.getItem("players")) || { ...defaultPlayers };
    }

    function savePlayers(players) {
      localStorage.setItem("players", JSON.stringify(players));
    }

    function updateRankingTable(players) {
      const table = document.getElementById("rankingTable").querySelector("tbody");
      table.innerHTML = "";
      const sorted = Object.entries(players).sort((a, b) => b[1] - a[1]);
      for (const [name, score] of sorted) {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${name}</td><td>${score}</td>`;
        table.appendChild(row);
      }
    }

    function giveBonus(amount) {
      const player = document.getElementById("bonusPlayer").value;
      let players = loadPlayers();
      players[player] += amount;
      savePlayers(players);
      updateRankingTable(players);
      alert(`${player} erhält +${amount} Punkte`);
    }

    function saveMatchHistory(entry) {
      const history = JSON.parse(localStorage.getItem("matchHistory")) || [];
      history.unshift(entry);
      localStorage.setItem("matchHistory", JSON.stringify(history));
      updateMatchHistory();
    }

    function updateMatchHistory() {
      const list = document.getElementById("matchHistoryList");
      const history = JSON.parse(localStorage.getItem("matchHistory")) || [];
      list.innerHTML = "";
      for (const match of history) {
        const li = document.createElement("li");
        li.textContent = `${match.winner} gewinnt gegen ${match.loser} (${match.date})`;
        list.appendChild(li);
      }
    }

    document.getElementById("matchForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const playerA = form.playerA.value;
      const playerB = form.playerB.value;
      const winner = form.winner.value;

      if (playerA === playerB) {
        alert("Spieler dürfen nicht gleich sein!");
        return;
      }

      let players = loadPlayers();
      const aPoints = players[playerA];
      const bPoints = players[playerB];
      const diff = Math.abs(aPoints - bPoints);
      let pointsA = 0, pointsB = 0;

      if (diff >= 200) {
        alert("Match zählt nicht (zu großer Klassenunterschied)");
        return;
      }

      if (diff < 100) {
        pointsA = winner === playerA ? 20 : -20;
        pointsB = winner === playerB ? 20 : -20;
      } else if (aPoints > bPoints) {
        pointsA = winner === playerA ? 10 : -10;
        pointsB = winner === playerB ? 30 : -30;
      } else {
        pointsA = winner === playerA ? 30 : -30;
        pointsB = winner === playerB ? 10 : -10;
      }

      players[playerA] += pointsA;
      players[playerB] += pointsB;
      savePlayers(players);
      updateRankingTable(players);

      const loser = winner === playerA ? playerB : playerA;
      saveMatchHistory({ winner, loser, date: new Date().toLocaleString() });

      alert("Match eingetragen!");
    });

    updateRankingTable(loadPlayers());
    updateMatchHistory();
  </script>
</body>
</html>
